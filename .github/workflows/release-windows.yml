name: Release (Windows)

on:
  workflow_dispatch: {}

jobs:
  release-windows:
    runs-on: windows-latest
    defaults:
      run:
        shell: bash
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Install Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.10.1'

      - name: Install Poetry
        run: curl -sSL https://install.python-poetry.org | python -

      - name: Update PATH
        run: echo "$APPDATA\Python\Scripts" >> $GITHUB_PATH

      - name: Install production dependencies
        run: poetry install --no-dev

      - name: Install UPX
        uses: crazy-max/ghaction-chocolatey@v1
        with:
          args: install upx

      - name: Bundle executable
        run: poetry run pyinstaller -F --version-file bundle/win_version_file bundle/bundle.spec
